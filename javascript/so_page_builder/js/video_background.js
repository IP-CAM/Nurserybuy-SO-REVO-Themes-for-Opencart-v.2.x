!function(){if(void 0==jQuery)console.log("Jquery not included!");else if(void 0==Modernizr.video)console.log("Modernizr not included!");else{var i=jQuery,t=-1!=(o=navigator.userAgent.toLowerCase()).indexOf("msie")&&parseInt(o.split("msie")[1]),e=0,s=0;jQuery.fn.extend({ensureLoad:function(e){return this.each(function(){this.complete||4===this.readyState?e.call(this):"uninitialized"===this.readyState&&0===this.src.indexOf("data:")?(i(this).trigger("error"),e.call(this)):(i(this).one("load",e),t&&void 0!=this.src&&-1==this.src.indexOf("?")&&(this.src=this.src+"?"+(new Date).getTime()))})}}),video_background=function(t,s){return this.hidden=!1,this.$holder=t,this.id="video_background_video_"+e,e++,this.parameters={position:"absolute","z-index":"-1",video_ratio:!1,loop:!0,autoplay:!0,muted:!1,mp4:!1,webm:!1,ogg:!1,flv:!1,youtube:!1,priority:"html5",swfpath:"others/video.swf",fallback_image:!1,sizing:"fill",start:0},i.each(s,i.proxy(function(i,t){this.parameters[i]=t},this)),this.$video_holder=i('<div id="'+this.id+'"></div>').appendTo(t).css({"z-index":this.parameters["z-index"],position:this.parameters.position,top:0,left:0,right:0,bottom:0,overflow:"hidden"}),this.ismobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),this.supports_flash=9<swfobject.getFlashPlayerVersion().major&&(!1!==this.parameters.mp4||!1!==this.parameters.flv),this.supports_video=Modernizr.video&&(Modernizr.video.h264&&!1!==this.parameters.mp4||Modernizr.video.ogg&&!1!==this.parameters.ogg||Modernizr.video.webm&&!1!==this.parameters.webm),this.decision="image",this.ismobile||!this.supports_flash&&!this.supports_video&&!1===this.parameters.youtube||(this.decision=this.parameters.priority,!1!==this.parameters.youtube?this.decision="youtube":"flash"==this.parameters.priority&&this.supports_flash?this.decision="flash":"html5"==this.parameters.priority&&this.supports_video?this.decision="html5":this.supports_flash?this.decision="flash":this.supports_video&&(this.decision="html5")),"image"==this.decision?this.make_image():"youtube"==this.decision?this.make_youtube():"html5"==this.decision?this.make_video():this.make_flash(),this},video_background.prototype={make_video:function(){var t='<video width="100%" height="100%" '+(this.parameters.autoplay?"autoplay ":"")+(this.parameters.loop?'loop onended="this.play()" ':"")+">";!1!==this.parameters.mp4&&(t+='<source src="'+this.parameters.mp4+'" type="video/mp4"></source>'),!1!==this.parameters.webm&&(t+='<source src="'+this.parameters.webm+'" type="video/webm"></source>'),!1!==this.parameters.ogg&&(t+='<source src="'+this.parameters.ogg+'" type="video/ogg"></source>'),this.$video=i(t+"</video>").css({position:"absolute"}),this.$video_holder.append(this.$video),this.video=this.$video.get(0),!1!==this.parameters.video_ratio&&(this.resize_timeout=!1,i(window).resize(i.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(i.proxy(this.video_resize,this),10)},this)),this.video_resize()),this.parameters.muted&&this.mute()},video_resize:function(){var i=this.$video_holder.width(),t=this.$video_holder.height(),e=i,s=i/this.parameters.video_ratio;s<t&&(s=t,e=t*this.parameters.video_ratio),s=Math.ceil(s),e=Math.ceil(e),t=Math.round(t/2-s/2),i=Math.round(i/2-e/2),this.$video.attr("width",e),this.$video.attr("height",s),this.$video.css({top:t+"px"})},make_youtube:function(){var t=i("html");if(this.$video=i('<div id="'+this.id+'_yt"></div>').appendTo(this.$video_holder).css({position:"absolute"}),this.youtube_ready=!1,0==s){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o),s=1,window.onYouTubeIframeAPIReady=i.proxy(function(){t.trigger("yt_loaded"),this.build_youtube(),s=2},this)}else 1==s?t.bind("yt_loaded",i.proxy(this.build_youtube,this)):2==s&&this.build_youtube()},build_youtube:function(){var t={loop:this.parameters.loop?1:0,start:this.parameters.start,autoplay:this.parameters.autoplay?1:0,controls:0,showinfo:0,wmode:"transparent",iv_load_policy:3,modestbranding:1,rel:0};this.parameters.loop&&(t.playlist=this.parameters.youtube),this.player=new YT.Player(this.id+"_yt",{height:"100%",width:"100%",playerVars:t,videoId:this.parameters.youtube,events:{onReady:i.proxy(this.youtube_ready_fun,this)}})},youtube_ready_fun:function(t){this.youtube_ready=!0,this.$video=i("#"+this.id+"_yt"),!1!==this.parameters.video_ratio&&(this.resize_timeout=!1,i(window).resize(i.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(i.proxy(this.video_resize,this),10)},this)),this.video_resize()),this.parameters.muted&&this.mute()},make_flash:function(){var t={url:0!=this.parameters.mp4?this.parameters.mp4:this.parameters.flv,loop:this.parameters.loop,autoplay:this.parameters.autoplay,muted:this.parameters.muted};this.$video_holder.append('<div id="'+this.id+'_flash"></div>'),swfobject.embedSWF(this.parameters.swfpath,this.id+"_flash","100%","100%","9.0",null,t,{allowfullscreen:!0,allowScriptAccess:"always",wmode:"transparent"},{name:"background-video-swf"},i.proxy(this.flash_callback,this))},flash_callback:function(t){this.video=i(t.target).get(0),this.parameters.muted&&this.mute()},make_image:function(){!1!==this.parameters.fallback_image&&(this.$img=i('<img src="'+this.parameters.fallback_image+'" alt=""/>').appendTo(this.$video_holder).css({position:"absolute"}),this.$img.ensureLoad(i.proxy(this.image_loaded,this)))},image_loaded:function(){this.original_width=this.$img.width(),this.original_height=this.$img.height(),this.resize_timeout=!1,i(window).resize(i.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(i.proxy(this.image_resize,this),10)},this)),this.image_resize()},image_resize:function(){var i=this.$video_holder.width(),t=this.$video_holder.height(),e=i,s=this.original_height/(this.original_width/i);("adjust"==this.parameters.sizing&&s>t||"fill"==this.parameters.sizing&&s<t)&&(s=t,e=this.original_width/(this.original_height/t)),s=Math.ceil(s),e=Math.ceil(e),t=Math.round(t/2-s/2),i=Math.round(i/2-e/2),this.$img.css({width:e+"px",height:s+"px",top:t+"px",left:i+"px"})},isPlaying:function(){return"html5"==this.decision?!this.video.paused:"flash"==this.decision?video.isPlaying():!("youtube"!=this.decision||!this.youtube_ready)&&1===this.player.getPlayerState()},play:function(){"html5"==this.decision?this.video.play():"flash"==this.decision?this.video.resume():"youtube"==this.decision&&this.youtube_ready&&this.player.playVideo()},pause:function(){"html5"==this.decision||"flash"==this.decision?this.video.pause():"youtube"==this.decision&&this.youtube_ready&&this.player.pauseVideo()},toggle_play:function(){this.isPlaying()?this.pause():this.play()},isMuted:function(){return"html5"==this.decision?!this.video.volume:"flash"==this.decision?video.isMute():!("youtube"!=this.decision||!this.youtube_ready)&&this.player.isMuted()},mute:function(){"html5"==this.decision?this.video.volume=0:"flash"==this.decision?this.video.mute():"youtube"==this.decision&&this.youtube_ready&&this.player.mute()},unmute:function(){"html5"==this.decision?this.video.volume=1:"flash"==this.decision?this.video.unmute():"youtube"==this.decision&&this.youtube_ready&&this.player.unMute()},toggle_mute:function(){this.isMuted()?this.unmute():this.mute()},hide:function(){this.pause(),this.$video_holder.stop().fadeTo(700,0),this.hidden=!0},show:function(){this.play(),this.$video_holder.stop().fadeTo(700,1),this.hidden=!1},toogle_hidden:function(){this.hidden?this.show():this.hide()},rewind:function(){"html5"==this.decision?this.video.currentTime=0:"flash"==this.decision?this.video.rewind():"youtube"==this.decision&&this.youtube_ready&&this.player.seekTo(0)}}}var o}();